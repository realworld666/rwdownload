<?php/* * Copyright (c) 2023. * RW::Software * Dave Conley * https://www.rwscripts.com/ *//********************************************************* * $HeadURL: http://www.maidenfans.com/svn/rwdownload_new/TRUNK/stats.php $ * $Revision: 50 $ * $LastChangedBy: realworld $ * $LastChangedDate: 2008-12-20 20:32:52 +0000 (Sat, 20 Dec 2008) $ * Version: 4.0 * Last edited: 20th February, 2005 * * Usage Instructions: * Type the following into a .php file: * <?php *        readfile ("http://www.yourwebsite.com/download/stats.php?ACT=XXX&limit=Y"); * ?> * Just replace yourwebsite.com with your own website url * Replace XXX with one of the following: * topdl - displays the most downloaded files * toprate - displays the higest rated files * latest - displays the latest added files * Replace Y with the number of items you wish to display * You may also change $ROOT_PATH to the full path to your downloads * folder if you have problems running this script *********************************************************/require_once("./functions/rwd_crypt_constants.php");// Do not edit anything below this point// Load config$CONFIG = array();require_once ROOT_PATH . "/globalvars.php";// Load required librariesrequire_once(ROOT_PATH . "/engine/mysql.php");// Load the database$dbinfo = array("sqlhost" => $CONFIG["sqlhost"],	"sqlusername" => $CONFIG["sqlusername"],	"sqlpassword" => $CONFIG["sqlpassword"],	"sqldatabase" => $CONFIG["sqldatabase"],	"sql_tbl_prefix" => $CONFIG["sqlprefix"]);$DB = new mysql($dbinfo);// Load more librariesrequire_once(ROOT_PATH . "/engine/users.php");require_once(ROOT_PATH . "/functions/rwd_crypt_functions.php");// Global functions$std = new rwdcryptfunc();// Get data from global arrays$IN = $std->saveGlobals();$std->loadNewStyleConfig();// Create the user array$guser = new user();$guser->initialise();if (!$guser->errormsg)	$guser->uservalidate();$path = $CONFIG["sitepath"];$home_url = $CONFIG["siteurl"];$sid = $std->createSession();$act = $HTTP_POST_VARS['ACT'] ? $HTTP_POST_VARS['ACT'] : $HTTP_GET_VARS['ACT'];$limit = intval($_GET['limit']);switch ($act) {	case 'topdl':		topDownloads($limit);		break;	case 'toprate':		topRatedDownloads($limit);		break;	case 'latest':		latestDownloads($limit);		break;	case 'link':		directLink($_GET['symid']);		break;}function directLink($id){	global $sid, $std, $home_url, $DB;	$id = intval($id);	$result = $DB->query("SELECT l.*, sym.*                    FROM dl_symlinks sym                    LEFT JOIN dl_links l ON (l.did=sym.sym_did)                    WHERE sym.sym_id={$id}");	if ($myrow = $DB->fetch_row($result)) {		if (!$std->canAccess($myrow["sym_catid"], "canDL"))			continue;		echo "<a href='{$home_url}/index.php?ACT=dl&id={$id}&symid={$myrow['sym_id']}&sess={$sid}'>{$myrow['name']}</a>";	}}function topDownloads($limit = "0,5"){	global $DB, $guser, $std, $home_url;	$result = $DB->query("SELECT l.*, sym.*                    FROM dl_symlinks sym                    LEFT JOIN dl_links l ON (l.did=sym.sym_did)                    WHERE l.approved=1                    ORDER BY `downloads` DESC LIMIT $limit");	if ($myrow = $DB->fetch_row($result)) {		do {			if (!$std->canAccess($myrow["sym_catid"], "canBrowse"))				continue;			echo "- <a href='{$home_url}/index.php?dlid={$myrow['sym_id']}'>{$myrow['name']}</a> ({$myrow['downloads']})<br>";		} while ($myrow = $DB->fetch_row($result));	}}function topRatedDownloads($limit = "0,5"){	global $DB, $guser, $std, $home_url;	$result = $DB->query("SELECT l.*, sym.*                    FROM dl_symlinks sym                    LEFT JOIN dl_links l ON (l.did=sym.sym_did)                    WHERE l.approved=1 and l.votes > 5                    ORDER BY `userrating` DESC LIMIT $limit");	if ($myrow = $DB->fetch_row($result)) {		do {			if (!$std->canAccess($myrow["sym_catid"], "canBrowse"))				continue;			echo "- <a href='{$home_url}/index.php?dlid={$myrow['sym_id']}'>{$myrow['name']}</a> ({$myrow['userrating']})<br>";		} while ($myrow = $DB->fetch_row($result));	}}function latestDownloads($limit = "0,5"){	global $DB, $guser, $std, $home_url;	$result = $DB->query("SELECT l.*, sym.*                    FROM dl_symlinks sym                    LEFT JOIN dl_links l ON (l.did=sym.sym_did)                    WHERE l.approved=1                    ORDER BY `date` DESC LIMIT $limit");	if ($myrow = $DB->fetch_row($result)) {		do {			if (!$std->canAccess($myrow["sym_catid"], "canBrowse"))				continue;			echo "- <a href='{$home_url}/index.php?dlid={$myrow['sym_id']}'>{$myrow['name']}</a><br>";		} while ($myrow = $DB->fetch_row($result));	}}/*function showRandomDownload($catid=0, $pinnedOnly=0){    global $DB, $std;    if ( $catid )    {        if ( !$std->canAccess($catid) )            return;        $wherecat = " AND sl.sym_catid='{$catid}'";    }    if ( $pinnedOnly )    {        $wherepinned = " AND l.pinned='1'";    }    $result= $DB->query("SELECT * FROM `dl_links` l                         LEFT JOIN `dl_symlinks` sl ON (sl.sym_did=l.did)                         WHERE l.approved='1' $wherecat $wherepinned ORDER BY RAND()");    while ( $myrow=$DB->fetch_row($result) and !$std->canAccess($myrow["sym_catid"], "canBrowse" ))    {        echo $this->html->randomDownload($myrow);    }}*/?>